# 快速开始指南

## 安装步骤

1. **安装插件**
   - 将 `astrbot_plugin_moderation` 文件夹复制到 AstrBot 的 `data/plugins/` 目录下
   - 重启 AstrBot 或在 WebUI 的插件管理中点击"重载插件"
   - 安装依赖：`pip install aiohttp`

2. **配置插件**
   - 在 AstrBot WebUI 中进入插件管理页面
   - 找到 "AI消息审核" 插件并点击配置
   - 配置以下必需参数：

### 必需配置

1. **AI提供商**
   - 在 `ai_provider` 选项中选择您配置好的 AI 模型提供商
   - 确保该提供商支持中文理解

2. **审核群聊白名单**
   - 在 `whitelist_groups` 中添加需要审核的群聊ID
   - 只有这些群聊会被审核
   - 至少添加一个群聊ID

3. **WebUI密码**
   - 修改 `webui_password` 为您的安全密码
   - 默认密码是 `admin123`（建议修改）

### 推荐配置

1. **禁言时长**
   - 默认 10 分钟，可根据需要调整

2. **上下文消息数量**
   - 默认 5 条，建议保持 3-10 条之间
   - 更多上下文可以提高准确性，但会增加 AI 调用成本

3. **免审核用户**
   - 将管理员或特殊用户添加到 `whitelist_users`
   - 这些用户即使在审核群聊中也不会被审核

## 使用方法

### 1. 访问WebUI

1. 启动AstrBot后，插件会自动启动WebUI服务器
2. 访问 `http://你的服务器地址:8899`
3. 输入WebUI访问密码登录
4. 登录成功后进入管理界面

### 2. 配置审核群聊

在插件配置中添加要审核的群聊ID：

```
whitelist_groups: ["123456789", "987654321"]
```

只有这些群聊会被审核，其他群聊不会被审核。

### 3. 基本使用

插件安装配置完成后，会自动开始审核白名单中的群聊消息：

- 文字消息：如果启用 `enable_text_moderation`
- 图片消息：如果启用 `enable_image_moderation`

### 4. 查看审核记录

在群聊中发送命令：
```
/审核记录
```

### 5. 查看统计信息

在群聊中发送命令：
```
/审核统计
```

### 6. WebUI 管理

登录WebUI后可以：
- 查看所有审核记录
- 查看统计数据
- 管理员复核审核结果
- 查看AI学习数据

## 管理员复核流程

1. 访问 `http://你的服务器地址:8899`
2. 输入密码登录
3. 在"审核记录"标签页查看审核记录
4. 对于未复核的记录，点击"管理员复核"按钮
5. 选择审核判断是否正确
6. 可选填写管理员备注
7. 点击"提交反馈"

## 提高准确性的建议

1. **积极反馈**
   - 定期在 WebUI 中复核审核结果
   - 提供准确的反馈，帮助 AI 学习

2. **调整上下文数量**
   - 如果误判较多，可以增加上下文消息数量
   - 如果响应太慢，可以减少上下文消息数量

3. **自定义审核标准**
   - 根据您的群聊特点，修改 `moderation_system_prompt`
   - 添加群聊特定的审核规则

4. **使用免审核用户**
   - 将经常误判的用户添加到免审核列表
   - 将管理员添加到免审核列表

## 常见问题

### Q: 为什么插件不工作？

A: 检查以下几点：
1. 是否配置了 AI 提供商
2. 是否在 `whitelist_groups` 中配置了群聊ID
3. 是否启用了文字或图片审核
4. 用户是否在免审核列表中

### Q: 如何禁用自动撤回或禁言？

A: 在插件配置中：
- 设置 `auto_revoke` 为 `false` 禁用自动撤回
- 设置 `auto_mute` 为 `false` 禁用自动禁言

### Q: 如何访问 WebUI？

A: 访问 `http://你的服务器地址:8899`
- 默认端口是 8899
- 默认密码是 `admin123`（建议修改）

### Q: 如何修改WebUI端口？

A: 在插件配置中修改 `webui_port` 参数
- 修改后需要重启插件或AstrBot

### Q: 白名单机制是如何工作的？

A:
- 只有配置在 `whitelist_groups` 中的群聊会被审核
- 未配置的群聊不会被审核
- 配置在 `whitelist_users` 中的用户不会被审核（即使在审核群聊中）

### Q: AI 学习功能如何工作？

A: 当管理员提交反馈后：
- 正确的判断会被添加到正确样本
- 错误的判断会被添加到错误样本
- 当样本数量达到阈值（默认10）时，会更新 AI 学习数据

### Q: 如何减少误判？

A: 尝试以下方法：
1. 增加上下文消息数量
2. 积极提交管理员反馈
3. 使用免审核用户过滤
4. 自定义审核标准

### Q: WebUI端口被占用了怎么办？

A: 在插件配置中修改 `webui_port` 为其他端口
- 确保新端口未被占用
- 修改后需要重启插件

## 安全建议

1. **修改默认密码**
   - 修改 `webui_password` 为强密码

2. **限制访问**
   - 使用防火墙限制WebUI端口的访问
   - 只允许信任的IP访问

3. **定期备份**
   - 定期备份审核记录和学习数据

## 技术支持

如有问题，请查看 README.md 或在 GitHub 上提交 Issue。