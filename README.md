# AstrBot AI消息审核插件

基于AI的QQ群聊消息审核插件，支持文字和图片审核，自动撤回违规消息并禁言，具备上下文分析和学习能力。

## 功能特性

### 核心功能
- ✅ **文字消息审核**：自动审核群内文字消息
- ✅ **图片消息审核**：自动审核群内图片消息
- ✅ **上下文分析**：收集最近5条消息上下文，减少误判
- ✅ **自动撤回**：发现违规消息自动撤回
- ✅ **自动禁言**：违规用户自动禁言（时长可配置）
- ✅ **违规理由输出**：AI输出详细的违规原因

### 智能功能
- 🤖 **AI学习**：基于管理员反馈，AI不断学习减少误判
- 📊 **审核统计**：实时统计审核数据和准确率
- 🎯 **白名单管理**：只审核白名单中的群聊
- 👥 **免审核用户**：支持用户级别的免审核配置
- 📝 **管理员复核**：WebUI支持管理员人工复核审核结果

### 管理功能
- 🌐 **独立WebUI**：独立端口运行的Web管理界面
- 🔐 **密码保护**：WebUI访问需要密码验证
- 📋 **审核记录**：完整的审核历史记录
- 🔍 **详细报告**：每条消息的详细审核信息
- 💾 **数据持久化**：所有数据自动保存

## 安装方法

1. 将插件文件夹复制到AstrBot的 `data/plugins/` 目录下
2. 在AstrBot WebUI的插件管理中启用本插件
3. 安装依赖：`pip install aiohttp`
4. 在插件配置页面配置AI提供商和其他参数

## 配置说明

### 基础配置

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| `mute_duration` | 禁言时长（分钟） | 10 |
| `context_count` | 上下文消息数量 | 5 |
| `enable_text_moderation` | 启用文字审核 | true |
| `enable_image_moderation` | 启用图片审核 | true |
| `auto_mute` | 自动禁言 | true |
| `auto_revoke` | 自动撤回 | true |

### 白名单配置

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| `whitelist_groups` | 审核群聊白名单 | [] |
| `whitelist_users` | 免审核用户列表 | [] |

**注意**：只有配置在 `whitelist_groups` 中的群聊才会被审核，其他群聊不审核。

### WebUI配置

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| `webui_port` | WebUI端口 | 8899 |
| `webui_password` | WebUI访问密码 | admin123 |

### AI配置

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| `ai_provider` | AI提供商 | （需选择） |
| `moderation_system_prompt` | 审核系统提示词 | （默认提示词） |
| `learning_enabled` | 启用AI学习 | true |
| `learning_threshold` | 学习样本阈值 | 10 |

## 使用方法

### 命令列表

- `/审核记录` - 查看最近审核记录
- `/审核统计` - 查看审核统计信息
- `/审核管理` - 显示管理帮助

### WebUI管理

1. 访问 `http://你的服务器地址:8899` 进入登录页面
2. 输入WebUI访问密码（默认：admin123）
3. 登录后进入管理界面

WebUI功能：
- 查看审核记录
- 查看统计数据
- 管理员复核
- 查看AI学习数据
- 提交反馈

### 管理员复核流程

1. 访问 WebUI 并登录
2. 在"审核记录"标签页查看审核记录
3. 对于未复核的记录，点击"管理员复核"按钮
4. 选择审核判断是否正确
5. 可选填写管理员备注
6. 提交反馈

AI会根据管理员反馈不断学习，提高审核准确性。

## 审核标准

默认审核标准：

1. 涉及政治敏感内容
2. 包含色情、暴力、恐怖主义内容
3. 涉及诈骗、赌博等违法活动
4. 包含恶意攻击、辱骂、歧视性言论
5. 传播虚假信息或谣言

您可以在插件配置中自定义审核标准。

## 白名单机制

### 群聊白名单
- 只有配置在 `whitelist_groups` 中的群聊才会被审核
- 未配置的群聊不会被审核
- 支持配置多个群聊

### 用户白名单
- 配置在 `whitelist_users` 中的用户，即使在审核群聊中也不会被审核
- 适用于管理员或特殊用户

## 数据存储

插件数据存储在以下位置：

```
data/plugin_data/astrbot_plugin_moderation/
├── moderation_records.json    # 审核记录
├── learning_data.json         # 学习数据
└── learning_prompt.txt        # AI学习提示词
```

## 注意事项

1. **AI提供商配置**：首次使用前必须在配置中选择AI提供商
2. **白名单配置**：必须在 `whitelist_groups` 中配置要审核的群聊，否则不会审核任何群聊
3. **WebUI端口**：确保配置的端口未被占用
4. **密码安全**：建议修改默认密码以提高安全性
5. **上下文收集**：上下文消息数量建议设置为3-10条
6. **AI学习**：启用学习功能需要管理员积极反馈，才能提高准确性

## 安全建议

1. 修改默认的WebUI访问密码
2. 限制WebUI端口的访问（使用防火墙）
3. 定期备份审核记录和学习数据
4. 谨慎配置免审核用户

## 技术特性

- 异步处理，不影响群聊正常使用
- 支持OneBot v11协议
- 独立WebUI服务器，不依赖AstrBot主服务器
- 响应式WebUI，支持移动端访问
- 数据自动备份和恢复
- 错误处理和日志记录

## 版本历史

### v1.0.0 (2026-01-19)
- 初始版本发布
- 支持文字和图片审核
- 上下文分析功能
- 独立WebUI服务器
- 密码登录功能
- 白名单机制
- AI学习功能

## 许可证

MIT License

## 作者

wangxinghuo

## 支持与反馈

如有问题或建议，请在GitHub上提交Issue。

---

**免责声明**：本插件仅供学习和研究使用，使用本插件产生的任何后果由使用者自行承担。
